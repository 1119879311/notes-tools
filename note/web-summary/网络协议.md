### 网络协议

#### 网络ISO 七层模型 
- 应用层 ： http,FTP,Tftp
- 表示层:   teInet,Rlogin
- 会话层:   DNS,smtp
- 网络层 : TCP,UDP
- 传输层 : IP,ICMP
- 数据链路层
- 物理层
----

#### TCP/IP 四层模型
- 应用层
- 网络层
- 传输层
- 物理链继层
#### 一个http 请求过程
##### 发送过程
1、如果输入的是域名，首先会有DNS服务器解析，得到IP地址
2、得到ip 地址后，要判断给Ip 是不是一个子网络，这时候需要用到主机的子网掩码，
3、如果不是同一个子网络，就需要转发网关，接收方的MAC 地址将是网关的MAC 地址 (MAC 称为局域网地址或者物理地址)
4、知道接收方的所有信息，IP,端口，Mac 地址，从TCP层开始发送数据，数据将被推入协议栈中，一层层下传低
5、传输层：TCP头（20字节）+ http 请求报文
6、网络层： IP 头（20字节） + Tcp 头 （20字节）+ http请求 报文
7、链路层： MAC头 + IP 头+ TCP 头 + 请求报文
8、物理层： 转为010101 比特流进行 传输

##### 接收过程
1、当目标主机接收到以太数据以太网数据帧时，数据就会由下到上 进行各层协议的报头的校验，以确定接收的上层协议
2、链路层，会拿到 MAC 地址与当前的网卡 的Mac匹配，
3、网络层，拿到Ip 头，判断ip 是否与自己匹配，如果匹配继续交给上一层传输层
4、传输层：TCP 头中携带由端口，然后交给具体的进程处理

----

#### 在TCP 传输过程中有三次的握手 和四次挥手

##### 先了解一下TCP 连接过程中的关键字段
- 序号(sequence number)seq: 占32位
- 确认号(acknowledgement number)ack：
- 标记号 falgs: 分别为 URG,ACK,PSH,RST,SYN,FIN
  - URG:紧急指针有效
  - ACK: 确认序号有效，与ack 序号区别，用大写表示
  - PSH：接收方应该尽快将这个报文交给应用层
  - RST：重置连接。
  - SYN:发起一个连接
  - FIN: 释放一个连接

##### 三次握手
第一次：客户端发起请求连接，SYN=1,序号seq = x；
第二次：服务端收到客户端的请求，回复确认ACK=1,ack=x+1，同时向客户端发送一个连接和序号,SYN=1,seq=y;
第三次： 客户端收到服务器的请求，然后再次回复确认，ACK=1,ack = y+1;seq = x+1
建立连接，进行数据数据传输
##### 四次挥手
第一次：主动方发送FIN+ACK 报文。同时发送序号seq = z;
第二次： 接收方收到释放报文后回复确认请求 确认号为ack = z+1,同时发送自己的序号seq =Z
第三次： 接收方再发送一个FIN+ACK 报文给主动方，确认号ack = x，序号为seq =y;
第四次：主动方接收到FIN 报文后，会再次确认回复，确认号ack = y,序号为x
断开连接

---

#### 为什么需要四次挥手，握手才三次
握手的时候客户端与服务端连接，在收到SYN 连接的时候，服务端可以同时发送SYN+ACK 报文，而挥手不可以将FIN + ACK同时发送，因为服务端 收到客户端的FIN 的时候，有可能数据还在接收处理中，，因此我需要发送以ACK 确认客户端，当服务端数据接收处理完毕，再向客户端发送FIn报文

---

### 网络协议之http协议
- http 全称：超文本传输协议，属于应用层，http 是基于TCP/IP 协议的

### TCP/Ip
- Tcp 传输控制协议，应用程序之间的通讯,面向连接的
- Ip 负责计算机之间的通讯，是无连接的

---
### TCP与 UDP 区别
- TCP 是面向连接的，稳定的，有重连重发机制，UDP 是无连接的，不稳定的
- TCP 是字节流传输，UDP是数据报文传输的
- TCP 保证数据的正确顺序性，UDP不保证，可能出现掉包
- TCP 有滑动窗口机制保证对方发送流量控制，UDP没有流量控制

### 为什么TCP 是 可靠的
1、 三次握手和四次挥手，保证了连接和传输的稳定性
2、 有确认和重传机制
3. 有流量控制和拥塞控制

### 什么是字节流和数据报文
- 字节流是最基本的，所以的I/O 的字类都是，处理二进制的数据
- 字节是byte,报文是做了标记，封装的数据
- 报文是网络中传输的数据单元，传输过程中会不断的封装成分组、包、帧来传输，有报文头信息

---

#### http 工作原理
- http 用与客户端与服务器架架构（c/s架构）,即浏览器作为客户端 向 http服务器 发送请求，当服务器收到请求后会做出响应，默认端口为80 ，https默认端口为443


#### http 特点
- 无状态的，对客户端没有存储状态，对事务处理没有记忆能力
- 无连接的，每次请求只能处理一个请求，每次都会重新经过三次握手和四次挥手的操作
- 基于请求和响应，客户端发起请求，服务器响应
- 请求和响应都是文明的，无法保证数据的安全性

#### http 响应 组成部分
- 状态行
- 响应报头
- 空行
- 响应正文

#### http 请求方法
- GET:
- POST:
- PUT:
- DELETE: 
- HEAD:

#### GET 与 POST 区别
- 浏览器器回退时GET 刷新无害，Post 会重新被提交
- GET 产生的url 可以被浏览器收藏，Post 不可以
- Get 地址会被记录在浏览器的历史记录中，POST 不会
- GET请求在URL中传送的参数是有长度限制的，POST没有
- GET 相对 Post 安全性差，GET 是参数都在url可见 ，post 在请求体中，不可明见
- GET 发送的数据类型单一，只能是ASCll字符，post可以多种，比如二进制流
- GET 与 POST 还有其他的请求方法，本质是一样的，都是TCP/IP 协议，由于浏览器和服务器的限制导致了他们在一些语义上的不同
- GET 会产生一个TCP 包，POST 会产生两个tcp,火狐浏览器除外

### 关于 https
#### 基本特点
 - 超文本传输安全协议, 由http + SSL/TLS 组成 
 - 默认端口为443
 - 需要的证书要在权威CA 机构购买，需要费用
 - https 比http 慢，除了TCP 的三次握手，还需要客户端和服务端交互三个包和ssl 连接，总需12 次
 - https 是加密传输，安全性比http 高
 
#### https 工作流程
 - 客户端会访问服务端建立ssl 连接
 - 服务器收到客户端的请求后，会响应给客户的证书信息(包含公钥)
 - 客户端收到 证书信息好，会进行验证，如果是合法的，就会利用公钥生成会话密钥，发送给服务端
 - 服务端收到回话密钥后，利用私钥解码会话密钥
 - 服务器利用会话密钥 与客户端进行通讯

---